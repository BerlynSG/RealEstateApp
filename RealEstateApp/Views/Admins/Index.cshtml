@using RealEstateApp.Core.Application.ViewModels.User
@using Microsoft.AspNetCore.Http
@using RealEstateApp.Core.Application.Dtos.Account
@using RealEstateApp.Core.Application.Helpers;
@using RealEstateApp.Core.Application.Enums
@inject IHttpContextAccessor httpContextAccessor
@{
    var User = httpContextAccessor.HttpContext.Session.Get<AuthenticationResponse>("user");
}

@model SaveAdminsViewModel
@{
    ViewData["Title"] = "Registro";
}

<div class="container-fluid">
    <div class="row mb-3">
        @if (User.Rol != null && User.Rol == 3)
        {
            <div class="col-3 offset-9">
                <a asp-controller="Admins" asp-action="RegisterAdmin" class="btn btn-outline-success">Registrar administrador</a>
            </div>
        }
        else if (User.Rol != null && User.Rol == 4)
        {
            <div class="col-3 offset-9">
                <a asp-controller="Admins" asp-action="RegisterAdmin" class="btn btn-outline-success">Registrar desarrollador</a>
            </div>
        }

    </div>
</div>
<div class="row">
    <div class=" col-md-10 mx-auto">
        <div class="container pt-5 p-5 bg-dark rounded-3">
            <table id="table-invited" class=" table table-dark table-hover">

                
                @if (User.Rol == 3)
                {
                    <div class="d-flex justify-content-between mb-3 text-dark">
                        <h2 class="text-white">ADMINISTRADORES</h2>
                    </div>
                }
                else
                {
                    <div class="d-flex justify-content-between mb-3 text-dark">
                        <h2 class="text-white">DESARROLLADORES</h2>
                    </div>
                }
                <thead>
                    <tr>
                        <th scope="col">Nombre</th>
                        <th scope="col">Apellido</th>
                        <th scope="col">Usuario</th>
                        <th scope="col">Cedula</th>
                        <th scope="col">Correo</th>
                        <th scope="col">Rol</th>
                        <th scope="col">Estado</th>
                        <th class="text-center" scope="col">Editar</th>
                        <th class="text-center" scope="col">Cambiar estados</th>
                    </tr>
                </thead>
                @if (User.Rol == 3){
                    <tbody>
                        @foreach (AuthenticationResponse user in ViewBag.Users)
                        {
                            @if (user.Roles[0] == Roles.Administrador.ToString())
                            {
                                <tr class="table-light">
                                    <td>@user.FirstName</td>
                                    <td>@user.LastName</td>
                                    <td>@user.UserName</td>
                                    <td>@user.Cedula</td>
                                    <td>@user.Email</td>
                                    <td>@user.Roles[0]</td>
                                    <td>@(user.EmailConfirmed ? "Activo" : "Inactivo")</td>
                                    <td>
                                        @if (user.Id != User.Id)
                                        {
                                            <a asp-controller="Admins" asp-action="UpdateUser" asp-route-id="@user.Id" class="btn btn-sm btn-warning"><i class='bx bx-edit'></i></a>
                                        }
                                    </td>
                                    <td>
                                        @if (user.Id != User.Id)
                                        {
                                            @if (user.EmailConfirmed)
                                            {
                                                <a asp-controller="Admins" asp-action="ActivateUser" asp-route-id="@user.Id" class="btn btn-sm btn-primary px-4"><i class='bx bx-toggle-right'></i></a>
                                            }
                                            else
                                            {
                                                <a asp-controller="Admins" asp-action="ActivateUser" asp-route-id="@user.Id" class="btn btn-sm btn-danger px-4"><i class='bx bx-toggle-left'></i></a>
                                            }
                                        }
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                }
                else if (User.Rol == 4)
                {
                    <tbody>
                        @foreach (AuthenticationResponse user in ViewBag.Users)
                        {
                            @if (user.Roles[0] == Roles.Desarrollador.ToString())
                            {
                                <tr class="table-light">
                                    <td>@user.FirstName</td>
                                    <td>@user.LastName</td>
                                    <td>@user.UserName</td>
                                    <td>@user.Cedula</td>
                                    <td>@user.Email</td>
                                    <td>@user.Roles[0]</td>
                                    <td>@(user.EmailConfirmed ? "Activo" : "Inactivo")</td>
                                    <td>
                                        @if (user.Id != User.Id)
                                        {
                                            <a asp-controller="Admins" asp-action="UpdateUser" asp-route-id="@user.Id" class="btn btn-sm btn-warning"><i class='bx bx-edit'></i></a>
                                        }
                                    </td>
                                    <td>
                                        @if (user.Id != User.Id)
                                        {
                                            @if (user.EmailConfirmed)
                                            {
                                                <a asp-controller="Admins" asp-action="ActiveUser" asp-route-id="@user.Id" class="btn btn-sm btn-primary px-4"><i class='bx bx-toggle-right'></i></a>
                                            }
                                            else
                                            {
                                                <a asp-controller="Admins" asp-action="ActiveUser" asp-route-id="@user.Id" class="btn btn-sm btn-danger px-4"><i class='bx bx-toggle-left'></i></a>
                                            }
                                        }
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                }
            </table>
        </div>
    </div>
</div>
